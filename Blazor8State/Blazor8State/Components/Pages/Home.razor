@page "/"
@inject IHttpContextAccessor hca
@inject SessionManager sessions

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<p>@myCookieValue</p>

@if (services is not null)
{
    <p>State: @mystate</p>
}

@code
{
    private string myCookieValue = "<unread>";
    private Session services;
    private string mystate;

    protected override async Task OnInitializedAsync()
    {
        var httpContext = hca.HttpContext;
        if (httpContext is not null && !httpContext.Request.Cookies.ContainsKey("sessionId"))
        {
            myCookieValue = Guid.NewGuid().ToString();
            httpContext.Response.Cookies.Append("sessionId", myCookieValue);
        }

        if (httpContext is not null && httpContext.Request.Cookies.ContainsKey("sessionId"))
        {
            myCookieValue = httpContext.Request.Cookies["sessionId"];
        }

        if (!sessions.Contains(myCookieValue))
        {
            services = new Session();
            sessions.Add(myCookieValue, services);
            services.Add("mystate", Guid.NewGuid().ToString());
        }
        else
        {
            services = await sessions.GetSession(myCookieValue);
        }
        mystate = (string)services["mystate"];
    }
}